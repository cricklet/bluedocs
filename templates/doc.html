<html>
	<head>
		<!-- Fonts -->
		<link href='https://fonts.googleapis.com/css?family=Ubuntu:700,400,500|' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Inconsolata|Roboto+Mono|Droid+Sans+Mono|Ubuntu+Mono' rel='stylesheet' type='text/css'>

		<!-- Helpful libraries -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.slim.min.js"></script>

		<!-- Firebase -->
		<script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>

		<!-- CodeMirror -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/codemirror.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/codemirror.min.css"/>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/addon/mode/overlay.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/javascript/javascript.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/python/python.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/markdown/markdown.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/gfm/gfm.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/css/css.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/htmlmixed/htmlmixed.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/jsx/jsx.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/addon/mode/simple.js"></script>

		<!-- Firepad -->
		<script src="https://cdn.firebase.com/libs/firepad/1.3.0/firepad.js"></script>

		<!-- Blue -->
		<script src="/static/blue-markdown-mode.js"></script>
		<link rel="stylesheet" href="/static/doc.css" />
	</head>

	<body>
		<div id="firepad"></div>

		<!-- JS Entrypoint -->
		<script>
		var DOCUMENT_ID = '{{ doc_id  }}';
		var FIREBASE_URL = 'https://bluedocs.firebaseio.com/firepads/'

		var defaultText =
		"# Welcome!\n"
     + "\n"
     + "BlueDocs makes you more productive by providing a simple, practical collaborative text editor.\n"
     + "\n"
     + "To collaborate, simply share the url: http://bluedocs.io/docs/" + DOCUMENT_ID + "\n"
     + "\n"
     + "Features:\n"
     + " - [x] GitHub-style markdown highlighting.\n"
     + " - [x] Code highlighting: python, ruby, javascript, and more.\n"
     + " - [x] Collaborative editing. Give a friend the URL and try it!\n"
     + " - [ ] Folders?\n"
     + " - [ ] Share settings?\n"
     + "\n"
     + "Send me a message at: bluedocs.dev@gmail.com! "
		 + "All feedback is welcomed :)\n"
     + "\n"
     + "```python\n"
     + "def compute_greeting(name):\n"
     + "  return 'Hello, {}!'.format(name)\n"
     + "\n"
     + "print compute_greeting('Friend')\n"
     + "```\n\n";

		var firepadRef = new Firebase(FIREBASE_URL + DOCUMENT_ID);
		var codeMirror = CodeMirror(
			document.getElementById('firepad'),
			{
				lineWrapping: true,
				mode: {
					name: 'blue-markdown',
				}
			}
		);
		var firepad = Firepad.fromCodeMirror(
			firepadRef, codeMirror,	{ defaultText: defaultText }
		);

		// Hacky hacky hacky. This indents wrapped lines properly.
		// Taken from: https://codemirror.net/demo/indentwrap.html
		var charWidth = codeMirror.defaultCharWidth(), basePadding = 0;
		codeMirror.on("renderLine", function(codeMirror, line, elt) {
			var text = line.text;
			var unindentedText = text.trimLeft();

			var columns = 0;
			columns += CodeMirror.countColumn(line.text, null, codeMirror.getOption("tabSize"));
			if (unindentedText.startsWith("- ")) { columns += 2; }

			var off = columns * charWidth;
			// Remove indent & add padding.
			elt.style.textIndent = "-" + off + "px";
			elt.style.paddingLeft = (basePadding + off) + "px";
		});
		codeMirror.refresh();

		</script>
	</body>
</html>
