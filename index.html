<html>
	<head>
		<!-- Helpful libraries -->
		<script src="http://underscorejs.org/underscore.js"></script>
		<script src="http://code.jquery.com/jquery-1.12.1.min.js"></script>

		<!-- Firebase -->
		<script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>

		<!-- CodeMirror -->
		<script src="./libs/CodeMirror/lib/codemirror.js"></script>
		<link rel="stylesheet" href="./libs/CodeMirror/lib/codemirror.css"/>

		<script src="./libs/CodeMirror/addon/mode/overlay.js"></script>

		<script src="./libs/CodeMirror/mode/javascript/javascript.js"></script>
		<script src="./libs/CodeMirror/mode/python/python.js"></script>
		<script src="./libs/CodeMirror/mode/markdown/markdown.js"></script>
		<script src="./libs/CodeMirror/mode/gfm/gfm.js"></script>
		<script src="./libs/CodeMirror/mode/css/css.js"></script>
		<script src="./libs/CodeMirror/mode/htmlmixed/htmlmixed.js"></script>
		<script src="./libs/CodeMirror/mode/jsx/jsx.js"></script>
		<script src="./libs/CodeMirror/addon/mode/simple.js"></script>

		<script src="./blue-markdown.js"></script>

		<!-- Firepad -->
		<link rel="stylesheet" href="https://cdn.firebase.com/libs/firepad/1.3.0/firepad.css" />
		<script src="https://cdn.firebase.com/libs/firepad/1.3.0/firepad.js"></script>

		<style>
		html {
			height: 100%;
		}
		body {
			margin: 0;
			height: 100%;
			position: relative;
		}
		#firepad {
			width: 100%;
			max-width: 640px;
			margin-left: auto;
			margin-right: auto;
			height: 100%;
		}

		.CodeMirror {
			font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
		}

		.CodeMirror-line:first-child {
			margin-top: 32px;
		}

		.CodeMirror-line:last-child {
			margin-bottom: 32px;
		}

		.cm-code {
			font-family: "Lucida Console", monospace
		}

		.code.CodeMirror-line {
			font-family: "Lucida Console", monospace;
		}

		.code-start.CodeMirror-line {
			color: #888;
			padding-bottom: 0.4em;
		}

		.code-end.CodeMirror-line {
			color: #888;
			padding-top: 0.4em;
		}

		.cm-indent {
			font-family: "Lucida Console", monospace;
		}
		.cm-tab {
			display: inherit!important;
			// fixes bug with inline-none and custom indenting
		}
		.cm-bullet {
			font-family: "Lucida Console", monospace;
			color: #5cc;
		}

		.cm-meta {
			color: #5cc !important;
		}

		.cm-link-text {
			color: #5cc !important;
		}

		.cm-link-href {
			color: #5cc !important;
		}

		.cm-link-tag {
			color: #bbb;
		}

		.cm-header-tag {
			color: #bbb;
		}

		.cm-code-quoted {
			font-family: "Lucida Console", monospace;
			color: #888;
		}

		.header-1.CodeMirror-line {
			font-size: 175%;
		}
		.header-2.CodeMirror-line {
			font-size: 140%
		}
		.header-3.CodeMirror-line {
			font-size: 120%
		}
		.header-4.CodeMirror-line {
			font-size: 110%
		}
		</style>
	</head>

	<body>
		<div id="firepad"></div>

		<!-- JS Entrypoint -->
		<script>
		var firepadRef = new Firebase('https://bluedocs.firebaseio.com/');
		var codeMirror = CodeMirror(
			document.getElementById('firepad'),
			{
				lineWrapping: true,
				mode: {
					name: 'blue-markdown',
				}
			}
		);
		var firepad = Firepad.fromCodeMirror(
			firepadRef, codeMirror,	{ defaultText: 'Hello, World!' }
		);

		var charWidth = codeMirror.defaultCharWidth(), basePadding = 0;
		codeMirror.on("renderLine", function(codeMirror, line, elt) {
			var text = line.text;
			var unindentedText = text.trimLeft();

			var columns = 0;
			columns += CodeMirror.countColumn(line.text, null, codeMirror.getOption("tabSize"));
			if (unindentedText.startsWith("- ")) { columns += 2; }

			var off = columns * charWidth;
			// Remove indent & add padding.
			elt.style.textIndent = "-" + off + "px";
			elt.style.paddingLeft = (basePadding + off) + "px";
		});
		codeMirror.refresh();

		</script>
	</body>
</html>
